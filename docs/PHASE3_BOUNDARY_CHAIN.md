# Phase 3: Boundary Chain (B, B', B'') Management

Goal: Produce a sequence of disjoint prefix sets U_0, U_1, ... with strictly increasing distance boundaries B_0 < B_1 < ... each generated by a truncated basecase expansion. This establishes the structural decomposition necessary before multi-level recursion (Phase 4).

## Definitions
- Basecase(k, B_max): returns (U, B') with |U| ≤ k and distances(u) < B'.
- Boundary chain: sequence of pairs (U_i, B_i) where B_i = boundary returned by i-th truncated expansion and U_i are disjoint.
- Global visited set Vg: union of all U_i produced so far.

## Algorithm Sketch
```
Input: k0, attempt_max, chain_target (optional), n
Set visited = ∅, B_prev = 0
For i = 0..:
  Run truncated basecase from source ignoring already visited vertices (treat them as settled, skip relaxations into them)
  Receive (U_raw, B')
  Filter: U_i = { u in U_raw | u ∉ visited }
  Enforce disjointness: visited ← visited ∪ U_i
  Record (U_i, B')
  If |U_i| < k and basecase not truncated -> terminal (exhausted frontier)
  If chain_target reached or visited == n -> stop
```

## Stats
```
attempts
segments
total_collected
max_segment_size
monotonic_ok (0/1)
relaxations
```

## Invariants
1. Disjointness: U_i ∩ U_j = ∅ for i ≠ j.
2. Monotone boundaries: B_0 < B_1 < ... (strict if non-empty segment). Empty segments are skipped.
3. For every u ∈ U_i: dist[u] < B_i.
4. No vertex appears after it was first added to visited.

## Environment Variables
```
SSSP_SPEC_CHAIN_K        # initial k (default 1024)
SSSP_SPEC_CHAIN_MAX_SEG  # maximum segments (default 32)
SSSP_SPEC_CHAIN_TARGET   # optional total vertices target (default 0 means n)
```

## Simplifications (Initial)
- No reuse of previously computed predecessor subtrees beyond filtering.
- Single source; multi-source batching postponed.
- Distances stored globally; vertices not in any U_i remain INF.

---
Date: 2025-09-17